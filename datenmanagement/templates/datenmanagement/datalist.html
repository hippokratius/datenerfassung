{% extends "_base/navbar.html" %}
{% load datenmanagement_tags %}
{% load guardian_tags %}
{% load staticfiles %}

{% block title %}{{ model_verbose_name_plural }} | {% endblock %}

{% block meta %}
    {{ block.super }}
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
{% endblock %}

{% block table %}
    <link rel='stylesheet' type='text/css' href='{% static 'datatables-1.10.18/datatables.min.css' %}'/>
    <script src='{% static 'datatables-1.10.18/datatables.min.js' %}'></script>
{% endblock %}

{% block content %}
{% if object_list %}
    <h2>{{ model_verbose_name_plural }}</h2>
    <h4>{{ model_description }}</h4>
    <h3><i>Liste aller Datensätze</i></h3>
    <div class='row'>
        {% if user|user_has_model_add_permission:model_name_lower %}
            <a href="{% url 'datenmanagement:'|add:model_name|add:'add' %}" class='btn btn-success'>neuen Datensatz anlegen</a>
        {% endif %}
        {% if geometry_type %}
            <a href="{% url 'datenmanagement:'|add:model_name|add:'map' %}" class='btn btn-default'>Datensätze auf Karte anzeigen</a>
        {% endif %}
        <a href="{% url 'datenmanagement:'|add:model_name|add:'start' %}" class='btn btn-default'>zurück</a>
    </div>
	<div class='col-md-6 full-width'>
      <table id='datasets' class='table table-bordered table-striped'>
          <thead>
              <tr>
                  {% for label in list_fields_labels %}
                      {% with schritt=forloop.counter|stringformat:"s" %}
                          {% with spalte="spalte_"|add:schritt %}
                              <th>{{label}}</th>
                          {% endwith %}
                      {% endwith %}
                  {% endfor %}
                  <th><i>editieren</i></th>
                  <th><i>löschen</i></th>
              </tr>
          </thead>
      </table>
      <script type='text/javascript'>
          $(document).ready(function(){
              $('#datasets').dataTable({
                  ajax: "{% url 'datenmanagement:'|add:model_name|add:'data' %}",
                  columnDefs: [{
                    'orderable': false,
                    'targets': -2
                  }, {
                    'orderable': false,
                    'targets': -1
                  }],
                  language: {
                      url: '{% static 'datatables-1.10.18/datatables.german.lang' %}'
                  },
                  orderClasses: false,
                  pageLength: 25,
                  processing: true,
                  searchDelay: 500,
                  searching: true,
                  serverSide: true,
                  stateSave: true
              });
          });
      </script>
	</div>
{% else %}
    <h2>Keine Datensätze vorhanden.</h2>
    <div class='row'>
        {% if user|user_has_model_add_permission:model_name_lower %}
            <a href="{% url 'datenmanagement:'|add:model_name|add:'add' %}" class='btn btn-success'>neuen Datensatz anlegen</a>
        {% endif %}
        <a href="{% url 'datenmanagement:'|add:model_name|add:'start' %}" class='btn btn-default'>zurück</a>
    </div>
{% endif %}
{% endblock %}